# Internationalization (i18n) Design

## Overview

为 Dockerman 网站添加多语言支持，默认英文，可选中文。

## 核心决策

| 方面 | 决定 |
|------|------|
| URL 结构 | 路径前缀 `/en`, `/zh` |
| 根路径行为 | 根据偏好/浏览器语言重定向 |
| 偏好存储 | Cookie |
| i18n 库 | react-i18next |
| 翻译文件 | 按语言单文件 |
| 语言切换器 | 导航栏，主题切换旁边 |
| MDX 内容 | 按语言分文件，动态加载 |

## 路由结构

### URL 路由

- 所有页面都有语言前缀：`/en/about`, `/zh/about`
- 根路径 `/` 根据用户偏好重定向

### 目录结构

```
src/app/
├── [locale]/           # 动态语言路由
│   ├── layout.tsx      # 语言相关布局
│   ├── page.tsx        # 首页
│   ├── about/
│   │   └── page.tsx
│   ├── download/
│   │   └── page.tsx
│   └── changelog/
│       └── page.tsx
├── layout.tsx          # 根布局（保留）
└── page.tsx            # 重定向逻辑
```

### 中间件逻辑 (`middleware.ts`)

1. 检查路径是否已有语言前缀 → 放行
2. 检查 Cookie 中的语言偏好 → 重定向到对应语言
3. 读取 `Accept-Language` 头，检测是否包含 `zh` → 重定向到 `/zh` 或 `/en`
4. 设置 Cookie 记住选择

## i18n 配置

### 依赖

```
i18next
react-i18next
i18next-resources-to-backend
```

### 翻译文件结构

```
src/locales/
├── en.json    # 英文翻译
└── zh.json    # 中文翻译
```

### 翻译文件示例

```json
{
  "nav": {
    "about": "About",
    "download": "Download",
    "changelog": "Changelog"
  },
  "hero": {
    "title": "Manage Docker with Ease",
    "description": "A beautiful Docker desktop client..."
  },
  "features": {
    "title": "Features",
    "item1": "..."
  }
}
```

### 初始化文件

- `src/lib/i18n.ts` - i18next 配置
- `src/components/I18nProvider.tsx` - 客户端 Provider
- 在 `[locale]/layout.tsx` 中包裹 Provider，传入当前语言
- 服务端组件通过工具函数获取翻译

### 语言配置

```typescript
export const locales = ['en', 'zh'] as const
export const defaultLocale = 'en'
```

## 语言切换器组件

### 位置

- 在 `Navbar.tsx` 中，紧邻主题切换按钮
- 创建 `src/components/ui/LanguageSwitcher.tsx`

### UI 布局

```
[其他导航项] ... [语言切换] [主题切换]
```

- 显示当前语言标识（如 "EN" 或 "中"）
- 点击后下拉显示另一种语言选项
- 样式与主题切换按钮保持一致

### 切换逻辑

1. 用户点击目标语言
2. 更新 Cookie 存储偏好
3. 跳转到对应语言路径（如 `/en/about` → `/zh/about`）

### 实现细节

- 使用 `usePathname()` 获取当前路径
- 替换路径中的语言前缀
- 使用 `router.push()` 导航
- Cookie 设置 `NEXT_LOCALE` 偏好值

## 现有组件迁移

### 需要迁移的组件

| 组件 | 需提取的文本 |
|------|-------------|
| `Hero.tsx` | 标题、描述、按钮文字 |
| `Features.tsx` | 功能标题、描述、统计数据 |
| `Faqs.tsx` | 问题和答案 |
| `Cta.tsx` | 行动号召文案 |
| `Navbar.tsx` | 导航链接名称 |
| `Footer.tsx` | 页脚链接、版权信息 |

### 迁移方式

- 客户端组件：使用 `useTranslation()` hook
- 服务端组件：使用服务端翻译工具函数

### siteConfig.ts 处理

- SEO 元数据（title, description）需要根据语言动态生成
- 在 `[locale]/layout.tsx` 中根据 locale 参数设置 metadata

## MDX 多语言支持

### 文件结构

```
src/content/
├── changelog/
│   ├── en.mdx    # 英文 changelog
│   └── zh.mdx    # 中文 changelog
├── about/
│   ├── en.mdx
│   └── zh.mdx
```

### 加载逻辑

- 在 `[locale]/changelog/page.tsx` 中根据 `locale` 参数动态导入对应 MDX 文件
- 使用动态导入：`import(`@/content/changelog/${locale}.mdx`)`

### 回退策略

- 如果某语言的 MDX 不存在，回退到英文版本
- 可选：显示提示告知用户当前内容为英文

## 新增/修改的文件清单

- `middleware.ts` - 语言检测与重定向
- `src/lib/i18n.ts` - i18n 配置
- `src/components/I18nProvider.tsx` - 客户端 Provider
- `src/components/ui/LanguageSwitcher.tsx` - 语言切换器
- `src/locales/en.json` - 英文翻译
- `src/locales/zh.json` - 中文翻译
- `src/app/[locale]/` - 迁移现有页面
- `src/content/` - MDX 多语言文件
